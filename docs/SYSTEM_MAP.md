# üó∫Ô∏è MAPA DEL SISTEMA MiBarber

## 1. RESUMEN EJECUTIVO

### M√©tricas Generales
- **Total de archivos TypeScript/JavaScript**: 200+
- **Total de p√°ginas/rutas**: 12
- **Total de componentes**: 150+
- **Total de hooks personalizados**: 40+
- **Total de l√≠neas de c√≥digo**: ~50,000 l√≠neas aproximadamente
- **Stack tecnol√≥gico**: Next.js 15.5.3, React 19, TypeScript, Tailwind CSS, Supabase, TanStack Query, Zod

## 2. ARQUITECTURA DE CARPETAS

### Estructura Principal
```
src/
‚îú‚îÄ‚îÄ app/                    # P√°ginas y rutas de la aplicaci√≥n (Next.js App Router)
‚îú‚îÄ‚îÄ components/             # Componentes reutilizables de la UI
‚îú‚îÄ‚îÄ features/               # Funcionalidades organizadas por dominio
‚îÇ   ‚îú‚îÄ‚îÄ appointments/       # Gesti√≥n de citas
‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Autenticaci√≥n y autorizaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/          # Componentes del dashboard
‚îú‚îÄ‚îÄ hooks/                  # Hooks personalizados reutilizables
‚îú‚îÄ‚îÄ lib/                    # Librer√≠as y utilidades compartidas
‚îú‚îÄ‚îÄ shared/                 # Recursos compartidos entre features
‚îÇ   ‚îú‚îÄ‚îÄ types/              # Tipos TypeScript compartidos
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Utilidades compartidas
‚îú‚îÄ‚îÄ types/                  # Tipos de datos principales
‚îî‚îÄ‚îÄ utils/                  # Utilidades generales
```

### Convenciones de Organizaci√≥n
- **Patr√≥n de features**: Organizaci√≥n por dominios de negocio
- **Separaci√≥n de concerns**: Componentes, hooks, servicios y tipos claramente separados
- **Reexportaci√≥n**: Uso de archivos index.ts para facilitar imports
- **Alias de importaci√≥n**: Uso de `@/` para rutas absolutas

## 3. P√ÅGINAS Y RUTAS

### P√°gina Principal (`/`)
- **Archivo**: [src/app/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/page.tsx)
- **Prop√≥sito**: Redirecci√≥n basada en autenticaci√≥n
- **Componentes Hijos**: Componente de carga
- **Hooks Usados**: useEffect, useRouter
- **Permisos**: P√∫blico

### P√°gina de Inicio (`/inicio`)
- **Archivo**: [src/app/inicio/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/inicio/page.tsx)
- **Prop√≥sito**: Dashboard principal del usuario autenticado
- **Componentes Hijos**: [ProtectedDashboard](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/ProtectedDashboard.tsx), [AppointmentModalWithSucursal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AppointmentModalWithSucursal.tsx)
- **Hooks Usados**: [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts), [useCitas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useCitas.ts)
- **Estado Local**: useState para manejo de modales y citas seleccionadas
- **Permisos**: Usuarios autenticados

### P√°gina de Login (`/login`)
- **Archivo**: [src/app/login/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/login/page.tsx)
- **Prop√≥sito**: Autenticaci√≥n de usuarios
- **Componentes Hijos**: Formulario de login
- **Hooks Usados**: useState, useEffect, useRouter, [getSupabaseClient](file:///c:/Users/Fito/Documents/APP/MiBarber/src/lib/supabaseClient.ts)
- **Estado Local**: Manejo de credenciales, loading y errores
- **Permisos**: P√∫blico

### P√°gina de Mi Barber√≠a (`/mi-barberia`)
- **Archivo**: [src/app/mi-barberia/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/mi-barberia/page.tsx)
- **Prop√≥sito**: Configuraci√≥n y gesti√≥n de la barber√≠a
- **Componentes Hijos**: [AdminProtectedRoute](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AdminProtectedRoute.tsx), m√∫ltiples modales de edici√≥n, secciones de gesti√≥n
- **Hooks Usados**: [useBarberiaInfo](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberiaInfo.ts), [useBarberoAuth](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberoAuth.ts), [useServiciosBarbero](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useServiciosBarbero.ts)
- **Estado Local**: Manejo de modales, estados de edici√≥n
- **Permisos**: Solo administradores

### P√°gina de Mis Datos (`/mis-datos`)
- **Archivo**: [src/app/mis-datos/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/mis-datos/page.tsx)
- **Prop√≥sito**: Gesti√≥n del perfil del usuario
- **Componentes Hijos**: [EditarBarberoModal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/EditarBarberoModal.tsx)
- **Hooks Usados**: [useBarberoAuth](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberoAuth.ts), [useServiciosBarbero](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useServiciosBarbero.ts)
- **Permisos**: Usuarios autenticados (no administradores)

### P√°gina Protegida (`/protected`)
- **Archivo**: [src/app/protected/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/protected/page.tsx)
- **Prop√≥sito**: Vista principal del dashboard con Kanban
- **Componentes Hijos**: [KanbanBoardDndKit](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/KanbanBoardDndKit.tsx), [AppointmentModalWithSucursal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AppointmentModalWithSucursal.tsx), [CustomDatePicker](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/CustomDatePicker.tsx)
- **Hooks Usados**: [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts), [useBarberos](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberos.ts), [useSucursales](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useSucursales.ts), [useCitas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useCitas.ts)
- **Estado Local**: Filtros de fecha, sucursal y barbero
- **Permisos**: Usuarios autenticados

### P√°gina de Agenda (`/(main)/agenda`)
- **Archivo**: [src/app/(main)/agenda/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/(main)/agenda/page.tsx)
- **Prop√≥sito**: Visualizaci√≥n y gesti√≥n de citas en calendario
- **Componentes Hijos**: [AgendaBoard](file:///c:/Users/Fito/Documents/APP/MiBarber/src/features/appointments/components/AgendaBoard/index.tsx), [AppointmentModalWithSucursal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AppointmentModalWithSucursal.tsx)
- **Hooks Usados**: [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts), [useCitas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useCitas.ts), [useBarberos](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberos.ts), [useBarberiaInfo](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberiaInfo.ts), [useBarberoAuth](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberoAuth.ts), [useSucursales](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useSucursales.ts)
- **Estado Local**: Filtros, modales, vista seleccionada
- **Permisos**: Usuarios autenticados

### P√°gina de Estad√≠sticas (`/(main)/estadisticas`)
- **Archivo**: [src/app/(main)/estadisticas/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/(main)/estadisticas/page.tsx)
- **Prop√≥sito**: Panel de estad√≠sticas y m√©tricas del negocio
- **Componentes Hijos**: [BarberoStatsView](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/BarberoStatsView.tsx), [AdminStatsView](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AdminStatsView.tsx), [ExportarEstadisticas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/ExportarEstadisticas.tsx)
- **Hooks Usados**: [useBarberoAuth](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberoAuth.ts), [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts), [useEstadisticas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useEstadisticas.ts)
- **Estado Local**: Per√≠odo seleccionado
- **Permisos**: Solo administradores

### P√°gina de Clientes (`/clientes`)
- **Archivo**: [src/app/clientes/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/clientes/page.tsx)
- **Prop√≥sito**: Gesti√≥n de clientes de la barber√≠a
- **Componentes Hijos**: [ClientsTable](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/ClientsTable.tsx), [AdminProtectedRoute](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AdminProtectedRoute.tsx)
- **Hooks Usados**: [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts)
- **Permisos**: Solo administradores

### P√°gina de WhatsApp (`/whatsapp`)
- **Archivo**: [src/app/whatsapp/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/whatsapp/page.tsx)
- **Prop√≥sito**: Integraci√≥n con WhatsApp para comunicaci√≥n con clientes
- **Componentes Hijos**: [WhatsAppChat](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/WhatsAppChat.tsx)
- **Hooks Usados**: [usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts)
- **Permisos**: Usuarios autenticados

### P√°gina En Desarrollo (`/en-desarrollo`)
- **Archivo**: [src/app/en-desarrollo/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/en-desarrollo/page.tsx)
- **Prop√≥sito**: P√°gina temporal para rutas en desarrollo
- **Componentes Hijos**: Mensaje de p√°gina en desarrollo
- **Hooks Usados**: useEffect, useRouter
- **Permisos**: Usuarios autenticados

### P√°gina de Administraci√≥n (`/admin`)
- **Archivo**: [src/app/admin/page.tsx](file:///c:/Users/Fito/Documents/APP/MiBarber/src/app/admin/page.tsx)
- **Prop√≥sito**: Configuraci√≥n inicial del sistema
- **Componentes Hijos**: Formulario de configuraci√≥n inicial
- **Hooks Usados**: useState, useRouter, [getSupabaseClient](file:///c:/Users/Fito/Documents/APP/MiBarber/src/lib/supabaseClient.ts)
- **Estado Local**: Formulario de configuraci√≥n
- **Permisos**: P√∫blico (solo para configuraci√≥n inicial)

## 4. COMPONENTES COMPLETOS

### Componentes Principales
1. **[AgendaBoard](file:///c:/Users/Fito/Documents/APP/MiBarber/src/features/appointments/components/AgendaBoard/index.tsx)** - Componente principal del calendario de citas
2. **[KanbanBoardDndKit](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/KanbanBoardDndKit.tsx)** - Tablero Kanban para gesti√≥n de citas
3. **[ClientsTable](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/ClientsTable.tsx)** - Tabla de gesti√≥n de clientes
4. **[WhatsAppChat](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/WhatsAppChat.tsx)** - Componente de chat con WhatsApp
5. **[ProtectedDashboard](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/ProtectedDashboard.tsx)** - Dashboard principal protegido
6. **[AdminStatsView](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AdminStatsView.tsx)** - Vista de estad√≠sticas para administradores
7. **[BarberoStatsView](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/BarberoStatsView.tsx)** - Vista de estad√≠sticas para barberos
8. **[AppointmentModalWithSucursal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/AppointmentModalWithSucursal.tsx)** - Modal para crear/editar citas

### Componentes de Formularios
1. **[EditarBarberoModal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/EditarBarberoModal.tsx)** - Modal para editar datos de barbero
2. **[CrearBarberoModal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/CrearBarberoModal.tsx)** - Modal para crear nuevos barberos
3. **[EditarSucursalModal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/EditarSucursalModal.tsx)** - Modal para editar sucursales
4. **[EditarHorariosSucursalModal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/EditarHorariosSucursalModal.tsx)** - Modal para editar horarios de sucursales

### Componentes de UI
1. **[NavBar](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/NavBar.tsx)** - Barra de navegaci√≥n principal
2. **[MobileMenu](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/MobileMenu.tsx)** - Men√∫ m√≥vil responsive
3. **[UserDropdownMenu](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/UserDropdownMenu.tsx)** - Men√∫ desplegable de usuario
4. **[CustomDatePicker](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/CustomDatePicker.tsx)** - Selector de fechas personalizado

## 5. HOOKS PERSONALIZADOS

### Hooks de Datos
1. **[useCitas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useCitas.ts)** - Gesti√≥n de citas con React Query
2. **[useBarberos](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberos.ts)** - Gesti√≥n de barberos
3. **[useClientes](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useClientes.ts)** - Gesti√≥n de clientes
4. **[useServicios](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useServicios.ts)** - Gesti√≥n de servicios
5. **[useSucursales](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useSucursales.ts)** - Gesti√≥n de sucursales

### Hooks de Autenticaci√≥n
1. **[useBarberoAuth](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useBarberoAuth.ts)** - Estado de autenticaci√≥n del barbero
2. **[useLogin](file:///c:/Users/Fito/Documents/APP/MiBarber/src/features/auth/hooks/useLogin.ts)** - L√≥gica de login

### Hooks de Estado
1. **[usePageTitle](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/usePageTitle.ts)** - Gesti√≥n del t√≠tulo de la p√°gina
2. **[useEstadisticas](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useEstadisticas.ts)** - C√°lculo de estad√≠sticas
3. **[useDashboard](file:///c:/Users/Fito/Documents/APP/MiBarber/src/hooks/useDashboard.ts)** - Datos del dashboard

## 6. SERVICIOS Y APIs

### Clientes HTTP
- **Supabase Client**: Cliente principal para comunicaci√≥n con la base de datos
- **[getSupabaseClient](file:///c:/Users/Fito/Documents/APP/MiBarber/src/lib/supabaseClient.ts)**: Funci√≥n para obtener instancia del cliente de Supabase

### SDKs Externos
- **Supabase**: Para autenticaci√≥n y base de datos
- **FullCalendar**: Para el calendario de citas
- **DnD Kit**: Para funcionalidad de drag and drop

### Configuraciones de API
- **Supabase Configuration**: Configuraci√≥n de conexi√≥n a la base de datos
- **React Query Configuration**: Configuraci√≥n de cache y estado

## 7. CONTEXTOS Y ESTADO GLOBAL

### Context Providers
1. **[AuthContext](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/Providers.tsx)** - Contexto de autenticaci√≥n
2. **QueryClientProvider** - Contexto de React Query
3. **[Providers](file:///c:/Users/Fito/Documents/APP/MiBarber/src/components/Providers.tsx)** - Componente que agrupa todos los providers

### Estado Global
- **React Query**: Para gesti√≥n de estado del servidor
- **Context API**: Para estado de autenticaci√≥n
- **useState/useReducer**: Para estado local de componentes

## 8. UTILIDADES Y HELPERS

### Funciones de Formato
1. **[formatCurrency](file:///c:/Users/Fito/Documents/APP/MiBarber/src/utils/formatters.ts)** - Formateo de valores monetarios
2. **[formatWhatsAppTimestamp](file:///c:/Users/Fito/Documents/APP/MiBarber/src/utils/formatters.ts)** - Formateo de timestamps para WhatsApp
3. **[getLocalDateString](file:///c:/Users/Fito/Documents/APP/MiBarber/src/utils/dateUtils.ts)** - Conversi√≥n de fechas a formato local

### Funciones de Validaci√≥n
1. **AuthService** - Servicios de autenticaci√≥n
2. **Validations** - Validaciones de formularios y datos

## 9. TIPOS Y INTERFACES

### Interfaces Principales
1. **[Appointment](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L3-L32)** - Representa una cita
2. **[Client](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L34-L54)** - Representa un cliente
3. **[Barbero](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L56-L71)** - Representa un barbero
4. **[Service](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L73-L84)** - Representa un servicio
5. **[CajaRecord](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L86-L102)** - Representa un registro de caja
6. **[Barberia](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L124-L129)** - Representa una barber√≠a
7. **[Sucursal](file:///c:/Users/Fito/Documents/APP/MiBarber/src/types/db.ts#L131-L141)** - Representa una sucursal

## 10. FLUJOS DE DATOS PRINCIPALES

### Flujo de Autenticaci√≥n
```
Usuario ingresa credenciales ‚Üí 
Validaci√≥n en useLogin ‚Üí 
Consulta a Supabase ‚Üí 
Creaci√≥n de sesi√≥n (localStorage + cookies) ‚Üí 
Actualizaci√≥n de AuthContext ‚Üí 
Redirecci√≥n a dashboard
```

### Flujo de Creaci√≥n de Citas
```
Usuario abre modal de creaci√≥n ‚Üí 
Selecci√≥n de datos (fecha, hora, cliente, servicio) ‚Üí 
Validaci√≥n de datos ‚Üí 
Mutaci√≥n con React Query ‚Üí 
Inserci√≥n en Supabase ‚Üí 
Invalidaci√≥n de cache ‚Üí 
Actualizaci√≥n de UI
```

### Flujo de Navegaci√≥n
```
Usuario hace clic en enlace ‚Üí 
Next.js Router cambia ruta ‚Üí 
Carga de componente de p√°gina ‚Üí 
Ejecuci√≥n de hooks de datos ‚Üí 
Renderizado de UI
```

## 11. DEPENDENCIAS REACT QUERY

### Query Keys Principales
- `["citas"]` - Lista de citas
- `["barberos"]` - Lista de barberos
- `["clientes"]` - Lista de clientes
- `["servicios"]` - Lista de servicios
- `["sucursales"]` - Lista de sucursales
- `["barberoAuth"]` - Estado de autenticaci√≥n

### Mutations
- `createMutation` - Creaci√≥n de entidades
- `updateMutation` - Actualizaci√≥n de entidades
- `deleteMutation` - Eliminaci√≥n de entidades

## 12. DIAGRAMAS

### √Årbol de Componentes Principal
```mermaid
graph TD
    A[App] --> B[Providers]
    B --> C[AuthContext]
    B --> D[QueryClientProvider]
    B --> E[Layout]
    E --> F[NavBar]
    E --> G[Page Content]
    G --> H[Page Components]
```

### Flujo de Navegaci√≥n
```mermaid
graph LR
    A[Login] --> B[Dashboard]
    B --> C[Agenda]
    B --> D[Estad√≠sticas]
    B --> E[Mi Barber√≠a]
    B --> F[Clientes]
    B --> G[WhatsApp]
    B --> H[Mis Datos]
```